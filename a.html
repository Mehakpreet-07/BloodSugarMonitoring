<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Doctor Dashboard • Blood Sugar</title>
  <style>
    :root{
      --bg:#0b0d10; --panel:#12161c; --ink:#e8eef5; --muted:#9fb1c1;
      --ok:#3aa76d; --warn:#d79b00; --bad:#d9534f; --accent:#7ab7ff; --line:#1c2330;
    }
    *{box-sizing:border-box} html,body{height:100%}
    body{margin:0;background:var(--bg);color:var(--ink);font:15.5px/1.45 system-ui,Segoe UI,Roboto,sans-serif}
    a{color:var(--accent);text-decoration:none}
    .app{display:grid;grid-template-columns:260px 1fr;min-height:100vh}
    /* sidebar */
    .side{background:#0f1319;border-right:1px solid var(--line);padding:1rem}
    .brand{font-weight:700;font-size:1.4rem;margin:.25rem 0 1rem}
    .nav a{display:block;padding:.6rem .75rem;border-radius:10px;color:var(--ink)}
    .nav a.active,.nav a:hover{background:#141a22}
    /* header */
    .head{display:flex;align-items:center;justify-content:space-between;padding:.9rem 1.1rem;background:#0f1319;border-bottom:1px solid var(--line);position:sticky;top:0;z-index:2}
    .crumbs{font-weight:600}
    .avatar{display:flex;align-items:center;gap:.6rem;position:relative}
    .avatar .pic{width:36px;height:36px;border-radius:999px;background:#222;border:1px solid var(--line)}
    .avatar button{background:transparent;border:0;color:var(--ink);cursor:pointer;font-weight:600}
    .menu{position:absolute;right:0;top:48px;background:var(--panel);border:1px solid var(--line);border-radius:12px;min-width:180px;display:none}
    .menu a{display:block;padding:.65rem .8rem;color:var(--ink)}
    .menu a:hover{background:#141a22}
    /* content */
    .main{padding:1.1rem}
    .grid{display:grid;gap:1rem}
    .panel{background:var(--panel);border:1px solid var(--line);border-radius:14px;padding:1rem}
    .kpis{grid-template-columns:repeat(3,minmax(0,1fr))}
    .kpi h3{margin:0 0 .25rem;font-size:.9rem;color:var(--muted);font-weight:600}
    .kpi .val{font-size:1.8rem;font-weight:800}
    .badge{display:inline-block;padding:.15rem .5rem;border-radius:999px;font-size:.75rem}
    .b-ok{background:rgba(58,167,109,.15);color:var(--ok)}
    .b-warn{background:rgba(215,155,0,.15);color:var(--warn)}
    .b-bad{background:rgba(217,83,79,.15);color:var(--bad)}
    .two{grid-template-columns:1.1fr .9fr}
    .list{width:100%;border-collapse:collapse}
    .list th,.list td{border-bottom:1px solid var(--line);padding:.55rem .4rem;text-align:left}
    .list th{color:var(--muted);font-weight:600}
    .pill{padding:.15rem .5rem;border-radius:999px;font-size:.78rem}
    .p-Normal{background:rgba(58,167,109,.12);color:var(--ok)}
    .p-Borderline{background:rgba(215,155,0,.12);color:var(--warn)}
    .p-Abnormal{background:rgba(217,83,79,.12);color:var(--bad)}
    .tools{display:flex;gap:.6rem;flex-wrap:wrap;margin:.5rem 0 0}
    input,select,button{background:#0f1319;border:1px solid --line;color:var(--ink);padding:.55rem .65rem;border-radius:10px}
    button{border:1px solid var(--line)}
    button.primary{background:#1a2330;border-color:#263247}
    .muted{color:var(--muted)}
    canvas{width:100%;height:260px;background:#0f1319;border:1px solid var(--line);border-radius:10px}
    #weatherPanel .row{display:flex;align-items:center;gap:.6rem}
    @media (max-width:1000px){ .app{grid-template-columns:1fr} .side{position:sticky;top:0;z-index:3} .kpis,.two{grid-template-columns:1fr} }
  </style>
</head>
<body>
  <div class="app">
    <!-- SIDEBAR -->
    <aside class="side" role="navigation" aria-label="Doctor main">
      <div class="brand">Blood Sugar</div>
      <nav class="nav">
        <a class="active" href="#" aria-current="page">Dashboard</a>
        <a href="#">Patients</a>
        <a href="#">Alerts</a>
        <a href="#">Settings</a>
      </nav>
    </aside>

    <!-- MAIN -->
    <section>
      <!-- HEADER -->
      <header class="head">
        <div class="crumbs">Dashboard</div>
        <div class="avatar">
          <div class="pic" aria-hidden="true"></div>
          <button id="profileBtn" aria-haspopup="true" aria-expanded="false">Dr. A. Sharma ▾</button>
          <div id="profileMenu" class="menu" role="menu" aria-label="Profile">
            <a href="#" role="menuitem">My Profile</a>
            <a href="#" role="menuitem">Logout</a>
          </div>
        </div>
      </header>

      <main class="main">
        <!-- WEATHER -->
        <section class="panel" id="weatherPanel" aria-live="polite">
          <h2 style="margin:0 0 .5rem">Today’s Weather</h2>
          <div id="weatherInfo" class="muted">Loading current weather…</div>
        </section>

        <!-- KPIs -->
        <section class="grid kpis" style="margin-top:1rem">
          <div class="panel kpi">
            <h3>Total Patients</h3>
            <div class="val" id="kpiPatients">—</div>
            <div class="muted">Active panel</div>
          </div>
          <div class="panel kpi">
            <h3>Open Alerts</h3>
            <div class="val" id="kpiAlerts">—</div>
            <span class="badge b-bad" id="kpiCritical">— critical</span>
          </div>
          <div class="panel kpi">
            <h3>Today’s Consults</h3>
            <div class="val" id="kpiConsults">—</div>
            <span class="badge b-warn" id="kpiPending">— pending</span>
          </div>
        </section>

        <!-- CHART + RECENT ALERTS -->
        <section class="grid two" style="margin-top:1rem">
          <div class="panel">
            <h2 style="margin:0 0 .5rem">Abnormal Readings (Last 7 Days)</h2>
            <div class="tools">
              <input id="filterPatient" placeholder="Search patient…" aria-label="Search patient">
              <select id="filterCat" aria-label="Filter by category">
                <option value="">All</option>
                <option>Abnormal</option>
                <option>Borderline</option>
                <option>Normal</option>
              </select>
              <button class="primary" id="applyFilters">Apply</button>
            </div>
            <canvas id="trend" aria-label="Trend of blood sugar readings"></canvas>
            <details class="muted" style="margin-top:.5rem">
              <summary>Show data table</summary>
              <table class="list" id="dataTable"></table>
            </details>
          </div>

          <div class="panel">
            <h2 style="margin:0 0 .5rem">Recent Alerts</h2>
            <table class="list" id="alertTable">
              <thead><tr><th>When</th><th>Patient</th><th>Category</th><th>Note</th></tr></thead>
              <tbody></tbody>
            </table>
            <div class="tools"><button>View all alerts</button></div>
          </div>
        </section>

        <!-- PATIENTS SNAPSHOT -->
        <section class="panel" style="margin-top:1rem">
          <h2 style="margin:0 0 .5rem">Patients Snapshot</h2>
          <table class="list" id="patientsTable">
            <thead><tr><th>Name</th><th>Last reading</th><th>Status</th><th></th></tr></thead>
            <tbody></tbody>
          </table>
          <div class="tools"><a href="#">Go to Patients</a></div>
        </section>
      </main>
    </section>
  </div>

  <script>
    // ========= Avatar dropdown =========
    const btn = document.getElementById('profileBtn');
    const menu = document.getElementById('profileMenu');
    btn.addEventListener('click', () => {
      const open = menu.style.display === 'block';
      menu.style.display = open ? 'none' : 'block';
      btn.setAttribute('aria-expanded', String(!open));
    });
    document.addEventListener('click', (e)=>{
      if(!menu.contains(e.target) && !btn.contains(e.target)) {
        menu.style.display='none'; btn.setAttribute('aria-expanded','false');
      }
    });

    // ========= Weather (OpenWeatherMap) =========
    const WEATHER_KEY = 'REPLACE_WITH_YOUR_OPENWEATHERMAP_KEY';
    const weatherBox = document.getElementById('weatherInfo');

    function showWeather(data){
      try{
        const icon = data.weather[0].icon;
        const desc = data.weather[0].description;
        const temp = Math.round(data.main.temp);
        const hum  = data.main.humidity;
        const city = data.name;
        weatherBox.innerHTML =
          `<div class="row">
             <img src="https://openweathermap.org/img/wn/${icon}.png" alt="${desc}" width="48" height="48">
             <div><strong>${city}</strong><br>${desc[0].toUpperCase()+desc.slice(1)} • ${temp}°C • ${hum}% humidity</div>
           </div>`;
      }catch{ weatherBox.textContent = 'Unable to parse weather data.'; }
    }

    async function fetchWeatherBy(lat, lon){
      try{
        const res = await fetch(`https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lon}&units=metric&appid=${WEATHER_KEY}`);
        const data = await res.json();
        showWeather(data);
      }catch{ weatherBox.textContent = 'Unable to load weather data.'; }
    }

    navigator.geolocation.getCurrentPosition(
      pos => fetchWeatherBy(pos.coords.latitude, pos.coords.longitude),
      ()  => fetchWeatherBy(49.19, -122.85) // fallback: Surrey, BC
    );

    // ========= Demo data for KPIs / Alerts / Patients (replace with real later) =========
    const kpis = { patients: 42, alerts: 7, critical: 3, consults: 5, pending: 2 };
    document.getElementById('kpiPatients').textContent = kpis.patients;
    document.getElementById('kpiAlerts').textContent   = kpis.alerts;
    document.getElementById('kpiCritical').textContent = `${kpis.critical} critical`;
    document.getElementById('kpiConsults').textContent = kpis.consults;
    document.getElementById('kpiPending').textContent  = `${kpis.pending} pending`;

    const alerts = [
      { when:'Today 09:40', name:'R. Kaur', cat:'Abnormal', note:'> 3 abnormal in 7 days' },
      { when:'Today 08:15', name:'M. Singh', cat:'Borderline', note:'Post-meal spike' },
    ];
    const aBody = document.querySelector('#alertTable tbody');
    aBody.innerHTML = alerts.map(a =>
      `<tr><td>${a.when}</td><td>${a.name}</td><td><span class="pill p-${a.cat}">${a.cat}</span></td><td>${a.note}</td></tr>`
    ).join('');

    const patients = [
      { name:'Rahul C.', last:'Today 10:05', cat:'Normal' },
      { name:'Bhavni R.', last:'Yesterday 22:10', cat:'Abnormal' },
    ];
    const pBody = document.querySelector('#patientsTable tbody');
    pBody.innerHTML = patients.map(p =>
      `<tr><td>${p.name}</td><td>${p.last}</td><td><span class="pill p-${p.cat}">${p.cat}</span></td><td><a href="#">Open chart</a></td></tr>`
    ).join('');

    // ========= Tiny canvas line chart (demo) =========
    const cvs = document.getElementById('trend'), ctx = cvs.getContext('2d');
    const now = Date.now(), day = 86400000;
    const demo = [
      {x:now-6*day,y:175,cat:'Borderline'},
      {x:now-5*day,y:192,cat:'Abnormal'},
      {x:now-4*day,y:138,cat:'Borderline'},
      {x:now-3*day,y:205,cat:'Abnormal'},
      {x:now-2*day,y:118,cat:'Normal'},
      {x:now-1*day,y:210,cat:'Abnormal'},
      {x:now-0*day,y:126,cat:'Normal'},
    ];
    function draw(points){
      const w=cvs.clientWidth, h=cvs.clientHeight; cvs.width=w; cvs.height=h;
      ctx.clearRect(0,0,w,h);
      const xs = points.map(p=>p.x), ys = points.map(p=>p.y);
      const minx=Math.min(...xs), maxx=Math.max(...xs);
      const miny=Math.min(...ys), maxy=Math.max(...ys);
      const pad=28, X=t=> pad + (w-2*pad)*((t-minx)/(maxx-minx||1)), Y=v=> h-pad - (h-2*pad)*((v-miny)/(maxy-miny||1));
      ctx.strokeStyle='#2a3547'; ctx.beginPath(); ctx.moveTo(pad,pad); ctx.lineTo(pad,h-pad); ctx.lineTo(w-pad,h-pad); ctx.stroke();
      ctx.strokeStyle='#8aa3c7'; ctx.beginPath();
      points.sort((a,b)=>a.x-b.x).forEach((p,i)=>{ i?ctx.lineTo(X(p.x),Y(p.y)):ctx.moveTo(X(p.x),Y(p.y)); });
      ctx.stroke();
      points.forEach(p=>{ ctx.beginPath(); ctx.arc(X(p.x),Y(p.y),3,0,Math.PI*2); ctx.fillStyle = p.cat==='Abnormal'?'#d9534f':(p.cat==='Borderline'?'#d79b00':'#3aa76d'); ctx.fill(); });
    }
    draw(demo);

    // Filters (just redraw demo right now)
    document.getElementById('applyFilters').onclick = ()=> draw(demo);
  </script>
</body>
</html>
